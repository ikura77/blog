<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>記事エディター</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: sans-serif; padding: 1rem; background: #f9f9f9; }
    form { max-width: 600px; margin: auto; background: #fff; padding: 1rem; border-radius: 8px; }
    textarea, input[type="text"] {
      width: 100%; margin: 0.5rem 0; padding: 0.5rem;
    }
    img { max-width: 100%; height: auto; display: block; margin: 0.5rem 0; }
    #preview {
      margin-top: 1rem;
      padding: 1rem;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <h1>記事エディター</h1>

  <form id="editorForm">
    <input type="text" id="title" placeholder="タイトル"><br>
    <textarea id="content" placeholder="ここに本文を書いてください..."></textarea>
    <input type="file" id="imageInput" accept="image/*"><br>
    <button type="button" id="insertImage">画像を挿入</button>
    <button type="button" id="save">保存</button>
  </form>

  <h2>📄 プレビュー</h2>
  <div id="preview"></div>

  <script>
    const contentTextarea = document.getElementById('content');
    const imageInput = document.getElementById('imageInput');
    const insertImageBtn = document.getElementById('insertImage');
    const preview = document.getElementById('preview');

    insertImageBtn.addEventListener('click', () => {
      const file = imageInput.files[0];
      if (!file) return alert('画像を選んでください');
      const reader = new FileReader();
      reader.onload = (e) => {
        const imgTag = `<img src="${e.target.result}" alt="挿入画像">`;
        const start = contentTextarea.selectionStart;
        const end = contentTextarea.selectionEnd;
        const text = contentTextarea.value;
        contentTextarea.value = text.slice(0, start) + imgTag + text.slice(end);
        updatePreview(); // 画像表示を更新
      };
      reader.readAsDataURL(file);
    });

    document.getElementById('save').addEventListener('click', () => {
      const title = document.getElementById('title').value;
      const content = contentTextarea.value;
      const html = `<h1>${title}</h1>\n${content}`;
      localStorage.setItem('savedArticle', html);
      alert('保存しました');
    });

    function updatePreview() {
      preview.innerHTML = contentTextarea.value;
    }

    contentTextarea.addEventListener('input', updatePreview);
    window.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('savedArticle');
      if (saved) {
        const temp = document.createElement('div');
        temp.innerHTML = saved;
        document.getElementById('title').value = temp.querySelector('h1')?.textContent || '';
        contentTextarea.value = saved.replace(/<h1>.*?<\/h1>\n?/, '');
        updatePreview();
      }
    });
  </script>
</body>
</html>
