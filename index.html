<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Ë®ò‰∫ã‰∏ÄË¶ß - Business Style</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --main-color: #0d47a1;
      --accent-color: #1976d2;
      --bg-gradient: linear-gradient(135deg, #e3f2fd, #bbdefb);
      --card-bg: #ffffff;
      --text-color: #212121;
      --border-radius: 8px;
      --box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    body {
      font-family: 'Noto Sans JP', 'Roboto', sans-serif;
      background: var(--bg-gradient);
      color: var(--text-color);
      margin: 0;
      padding: 20px;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.8;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5em;
      color: var(--main-color);
    }
    .card {
      position: relative;
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid #e0e0e0;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
      height: 120px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    }
    .card .title-date {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
      gap: 10px;
    }
    .card h2 {
      font-size: 1.2em;
      margin: 0;
      color: var(--main-color);
      line-height: 1.4;
      flex: 1;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 0;
    }
    .card .date {
      font-size: 0.75em;
      color: #777;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .card .content-preview {
      font-size: 0.85em;
      color: #555;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .card .actions a {
      position: absolute;
      bottom: 10px;
      right: 15px;
      background: var(--main-color);
      color: white;
      text-decoration: none;
      padding: 6px 12px;
      border-radius: 30px;
      font-size: 0.8em;
      transition: background 0.3s;
    }
    .card .actions a:hover {
      background: var(--accent-color);
    }
    nav {
      text-align: center;
      margin-top: 40px;
    }
    nav a {
      background: var(--main-color);
      color: white;
      text-decoration: none;
      padding: 12px 24px;
      margin: 0 10px;
      border-radius: 30px;
      font-weight: bold;
      transition: background 0.3s;
      display: inline-block;
    }
    nav a:hover {
      background: var(--accent-color);
    }
    #toggleMonthView {
      background: var(--main-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 30px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 20px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      transition: background 0.3s;
    }
    #toggleMonthView:hover {
      background: var(--accent-color);
    }
    /* „Çπ„Éû„ÉõÂØæÂøú */
    @media (max-width: 600px) {
      .card {
        height: 100px;
        padding: 10px;
      }
      .card h2 {
        font-size: 1em;
      }
      .card .date {
        font-size: 0.65em;
      }
      .card .content-preview {
        font-size: 0.75em;
      }
      .card .actions a {
        font-size: 0.7em;
        padding: 5px 10px;
      }
    }
  </style>
</head>
<body>

<h1>Ë®ò‰∫ã‰∏ÄË¶ß</h1>

<button id="toggleMonthView">üìÖ ÊúàÂà•„ÅßË¶ã„Çã</button>

<div id="articlesList"></div>

<nav>
  <a href="editor.html">‚úèÔ∏è Êñ∞„Åó„ÅèÊõ∏„Åè</a>
  <a href="drafts.html">üìÑ ‰∏ãÊõ∏„Åç‰∏ÄË¶ß</a>
</nav>

<script>
// „Çø„Ç§„Éà„É´„Çí2Ë°å‰ª•ÂÜÖ„Å´Âèé„ÇÅ„ÇãÔºã„Çπ„Éû„ÉõÊôÇ„ÅØ„Åï„Çâ„Å´1ÊñáÂ≠óÁü≠„Åè
function fitTitleInTwoLines(titleText) {
  const temp = document.createElement('h2');
  temp.style.visibility = 'hidden';
  temp.style.position = 'absolute';
  temp.style.top = '-9999px';
  temp.style.left = '-9999px';
  temp.style.width = 'calc(100% - 80px)';
  temp.style.fontSize = window.innerWidth <= 600 ? '1em' : '1.2em';
  temp.style.fontWeight = 'bold';
  temp.style.lineHeight = '1.4';
  temp.style.padding = '0';
  temp.style.margin = '0';
  temp.style.whiteSpace = 'normal';
  temp.textContent = titleText;
  document.body.appendChild(temp);

  const oneLineHeight = temp.offsetHeight;
  const maxAllowedHeight = oneLineHeight * 2;

  let fitted = titleText;
  let extraCut = window.innerWidth <= 600 ? 1 : 0; // „Çπ„Éû„Éõ„Å™„Çâ„Åï„Çâ„Å´1ÊñáÂ≠óÁü≠„Åè

  while ((temp.offsetHeight > maxAllowedHeight || extraCut > 0) && fitted.length > 0) {
    fitted = fitted.slice(0, -1);
    temp.textContent = fitted + '‚Ä¶';
    if (extraCut > 0) extraCut--;
  }

  document.body.removeChild(temp);

  return fitted.length < titleText.length ? fitted + '‚Ä¶' : fitted;
}

const articlesList = document.getElementById("articlesList");
const toggleMonthView = document.getElementById("toggleMonthView");
const articles = JSON.parse(localStorage.getItem('articles') || '{}');
let monthView = false;

toggleMonthView.addEventListener("click", () => {
  monthView = !monthView;
  renderArticles();
  toggleMonthView.textContent = monthView ? "üìù ÂÖ®ÈÉ®„ÅÆË®ò‰∫ã„ÇíË¶ã„Çã" : "üìÖ ÊúàÂà•„ÅßË¶ã„Çã";
});

function formatDate(dateStr) {
  if (!dateStr) return "";
  const date = new Date(dateStr);
  if (isNaN(date)) return dateStr.replace(/\//g, ".");
  return date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' });
}

function renderArticles() {
  articlesList.innerHTML = "";

  const published = Object.entries(articles)
    .filter(([id, article]) => article.status === "published" || article.status === "public")
    .sort((a, b) => {
      const dateA = new Date(a[1].publishedAt || a[1].datePublished || a[1].date || 0);
      const dateB = new Date(b[1].publishedAt || b[1].datePublished || b[1].date || 0);
      return dateB - dateA;
    });

  if (published.length === 0) {
    articlesList.innerHTML = "<p style='text-align:center;'>„Åæ„Å†ÂÖ¨Èñã„Åï„Çå„ÅüË®ò‰∫ã„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>";
    return;
  }

  if (monthView) {
    const grouped = {};
    published.forEach(([id, article]) => {
      const baseDate = article.publishedAt || article.datePublished || article.date;
      const month = baseDate ? baseDate.slice(0, 7).replace("/", "-") : "‰∏çÊòé";
      if (!grouped[month]) grouped[month] = [];
      grouped[month].push({ id, ...article });
    });

    const months = Object.keys(grouped).sort((a, b) => b.localeCompare(a));

    months.forEach(month => {
      const monthSection = document.createElement("section");
      monthSection.style.marginTop = "40px";

      const monthTitle = document.createElement("h2");
      monthTitle.textContent = month.replace("-", "Âπ¥") + "Êúà„ÅÆË®ò‰∫ã ‚ñ∂";
      monthTitle.style.color = "var(--main-color)";
      monthTitle.style.fontSize = "1.4em";
      monthTitle.style.borderBottom = "2px solid var(--accent-color)";
      monthTitle.style.paddingBottom = "5px";
      monthTitle.style.marginBottom = "10px";
      monthTitle.style.cursor = "pointer";

      const articleContainer = document.createElement("div");
      articleContainer.style.marginTop = "10px";
      articleContainer.style.overflow = "hidden";
      articleContainer.style.maxHeight = "0";
      articleContainer.style.transition = "max-height 0.4s ease";

      monthTitle.addEventListener("click", () => {
        if (articleContainer.style.maxHeight === "0px" || articleContainer.style.maxHeight === "0") {
          articleContainer.style.maxHeight = articleContainer.scrollHeight + "px";
          monthTitle.textContent = month.replace("-", "Âπ¥") + "Êúà„ÅÆË®ò‰∫ã ‚ñº";
        } else {
          articleContainer.style.maxHeight = "0";
          monthTitle.textContent = month.replace("-", "Âπ¥") + "Êúà„ÅÆË®ò‰∫ã ‚ñ∂";
        }
      });

      grouped[month].forEach(article => {
        const card = createCard(article);
        articleContainer.appendChild(card);
      });

      monthSection.appendChild(monthTitle);
      monthSection.appendChild(articleContainer);
      articlesList.appendChild(monthSection);
    });

  } else {
    published.forEach(([id, article]) => {
      const card = createCard(article);
      articlesList.appendChild(card);
    });
  }
}

function createCard(article) {
  const card = document.createElement("div");
  card.className = "card";
  const preview = (article.content || article.summary || "Êú¨Êñá„Å™„Åó").replace(/\s+/g, '').slice(0, 15) + "‚Ä¶";
  card.innerHTML = `
    <div class="title-date">
      <h2>${fitTitleInTwoLines(article.title)}</h2>
      <div class="date">${formatDate(article.publishedAt || article.datePublished || article.date)}</div>
    </div>
    <div class="content-preview">${preview}</div>
    <div class="actions">
      <a href="article.html?id=${article.id}">Á∂ö„Åç„ÇíË™≠„ÇÄ</a>
    </div>
  `;
  return card;
}

renderArticles();
</script>

</body>
</html>
